            Bank REST API
    Назначение

Это backend-приложение на Java Spring Boot для управления банковскими картами.
Система позволяет:

- создавать и управлять картами,
- просматривать карты с фильтрацией и пагинацией,
- выполнять переводы между своими картами,
- управлять пользователями (создание, обновление, удаление),
- обеспечивать аутентификацию и авторизацию на основе JWT.

    Используемые технологии

Java 17+, Spring Boot 3 (Web, Data JPA, Security), PostgreSQL или MySQL, Liquibase для миграций, JWT (jjwt), 
Swagger/OpenAPI для документации, Docker Compose для удобного запуска, JUnit 5 и Mockito для тестирования.

    Структура проекта

В папке src/main/java/com/example/bankcards находятся пакеты:

- controller – REST-контроллеры;
- dto – классы для передачи данных (запросы и ответы);
- entity – JPA-сущности;
- repository – интерфейсы Spring Data для доступа к БД;
- service – интерфейсы и реализации бизнес-логики;
- security – конфигурация Spring Security и JWT;
- util – вспомогательные утилиты: шифрование, маскирование номеров карт, алгоритм Луна.

В src/main/resources/db/changelog лежат Liquibase-миграции, включая файл с начальными данными.

    Работа с базой данных и миграции

Приложение использует Liquibase.
При первом запуске применяются все миграции: создаются таблицы users и card.

Номера карт хранятся только в зашифрованном виде (AES/GCM) и никогда не возвращаются полностью.
В ответах API они отображаются маской вида **** **** **** 1234.

    Начальные пользователи

Для удобства тестирования создаются такие данные:

- администратор: логин "admin", пароль "adminpass";
- пользователь 1: логин "user", пароль "userpass";

    Аутентификация и авторизация

Приложение использует JWT.
Чтобы получить токен, нужно отправить POST-запрос на /auth/login с телом:
    {
    "username": "имя",
    "password": "пароль"
    }

В ответ придёт JSON:
    {
    "token": "jwt-токен"
    }

Все защищённые запросы выполняются с заголовком
Authorization: Bearer <jwt-токен>.

    Доступ:

- ROLE_ADMIN – полные права, управление пользователями и всеми картами.
- ROLE_USER – работа только со своими картами.

    Основные эндпоинты
Пользователи (администратор)

- GET /api/admin/users – список всех пользователей;
- GET /api/admin/users/{id} – получение пользователя по id;
- POST /api/admin/users – создание пользователя;
- PATCH /api/admin/users/{id} – обновление пользователя;
- DELETE /api/admin/users/{id} – удаление пользователя.

Карты (администратор)

- GET /api/admin/cards – список всех карт;
- POST /api/admin/cards – создание карты;
- PATCH /api/admin/cards/{id}/block – блокировка карты;
- PATCH /api/admin/cards/{id}/activate – активация карты;
- DELETE /api/admin/cards/{id} – удаление карты.

Карты (пользователь)

- GET /api/users/{userId}/cards – просмотр своих карт, поддерживается фильтр по статусу и пагинация;
- PATCH /api/users/{userId}/cards/{cardId}/request-block – запрос блокировки своей карты;
- POST /api/users/{userId}/cards/transfer – перевод средств между своими картами.
  
    Запуск приложения через Docker Compose
- В корне есть docker-compose.yml.

    Локально
Создать базу данных PostgreSQL или MySQL.
Указать параметры подключения в application.yml (spring.datasource.*).

    Swagger / OpenAPI

После запуска документация доступна по адресам:
- Swagger UI: http://localhost:8080/swagger-ui/index.html
- OpenAPI JSON: http://localhost:8080/v3/api-docs

    Тестирование

Ключевые сервисы (UserServiceImpl, CardServiceImpl) покрыты unit-тестами на JUnit5 и Mockito.
Проверяются все основные сценарии: создание, обновление и удаление пользователей, операции с картами, 
переводы (в том числе ошибочные), пагинация, фильтрация, корректность сообщений об ошибках.

    Безопасность

- JWT-аутентификация.
- Ролевой доступ к эндпоинтам.
- Глобальный обработчик исключений с единообразным форматом ответа.
- Шифрование номеров карт (AES/GCM).
- Маскирование номеров карт в ответах API.

    Итог

Чтобы начать работу:
- Склонировать репозиторий.
- Настроить application.yml (ключ шифрования карт и секрет JWT).
- Запустить через docker-compose up или mvn spring-boot:run.
- Авторизоваться под пользователем admin или любым из seed-пользователей, 
- получить JWT и использовать его в заголовках Authorization.


